---
layout: single
title: MyBatis í™œìš©í•˜ê¸°
categories: ['Spring & Spring boot']
tag: [Backend, Java, ìë°”, ì„œë²„, ì„œë¸”ë¦¿, ìŠ¤í”„ë§]
toc: true
---


ìŠ¤í”„ë§ì—ì„œ MyBatisë¥¼ í™œìš©í•˜ê¸° ìœ„í•´ Maven í”„ë¡œì íŠ¸ì˜ pom.xmlì— ë‹¤ìŒì˜ ë‚´ìš©ì´ ë¨¼ì € ì„¸íŒ…ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.

```xml
<!-- database -->
	<dependency>
	    <groupId>com.oracle.database.jdbc</groupId>
	    <artifactId>ojdbc10</artifactId>
	    <version>19.22.0.0</version>
	</dependency>
	
	<dependency>
	    <groupId>org.mybatis</groupId>
	    <artifactId>mybatis</artifactId>
	    <version>3.5.16</version>
	</dependency>

	<dependency>
	    <groupId>org.mybatis</groupId>
	    <artifactId>mybatis-spring</artifactId>
	    <version>3.0.3</version>
	</dependency>
	
	<dependency>
	    <groupId>com.zaxxer</groupId>
	    <artifactId>HikariCP</artifactId>
	    <version>5.1.0</version>
	</dependency>
```

# ğŸ“– Junitì„ í†µí•´ ë“œë¼ì´ë²„ ì—°ê²° í…ŒìŠ¤íŠ¸í•˜ê¸°

[project] â†’ [Build Path] â†’ [Configure Build Path] â†’ [Libraries] â†’ [Class pathì—ì„œ Add Library] â†’ [Junit ì„ íƒ] ì´ ê³¼ì •ì„ í†µí•´ Junit ì‚¬ìš© í™˜ê²½ì„ ì„¤ì •í•´ì¤€ë‹¤.

### pom.xml

```xml
<dependency>
  <groupId>junit</groupId>
  <artifactId>junit</artifactId>
  <version>4.13.2</version>
  <scope>test</scope>
</dependency>

<!-- ìŠ¤í”„ë§ê³¼ junit ì—°ê²°ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-test</artifactId>
  <version>5.3.34</version>
  <scope>test</scope>
</dependency>
```

maven í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ì´ ë‚´ìš©ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ë°, ë²„ì „ì€ ë³¸ì¸ì´ ì›í•˜ëŠ” ê²ƒì„ ì§€ì •í•´ì£¼ë©´ ëœë‹¤.

src í´ë” ë°‘ì— test/java í´ë”ë¥¼ ë§Œë“¤ì–´ì£¼ê³ , ê·¸ ì•ˆì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

### OracleConnectionTest.java

```java
public class OracleConnectionTest {
	@Test
	public void ConnectionTest() throws Exception {
		Class.forName("oracle.jdbc.driver.OracleDriver");
		String url = "jdbc:oracle:thin:@localhost:1521:xe";
		Connection conn = DriverManager.getConnection(url, "user1", "1111");

		System.out.println(conn);
		conn.close();
	}
}
```

@Test ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ í…ŒìŠ¤íŠ¸í•  ë©”ì„œë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

DBCPë¥¼ HikariCPë¡œ ì¤€ë¹„í•˜ê³ , dataSourceê°€ ì˜ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì.

### root-config.xml

hikariCP dataSourceì— ëŒ€í•œ ë¹ˆ ê°ì²´ë¥¼ ìƒì„±í•´ì¤€ë‹¤.

```xml
<bean class="com.zaxxer.hikari.HikariConfig" id="hikariConfig">
	<property name="driverClassName" value="oracle.jdbc.driver.OracleDriver" />
	<property name="jdbcUrl" value="jdbc:oracle:thin:@localhost:1521:xe" />
	<property name="username" value="user1" />
	<property name="password" value="1111" />
</bean>

<bean class="com.zaxxer.hikari.HikariDataSource" id="dataSource">
	<constructor-arg ref="hikariConfig"></constructor-arg>
</bean>
```

### DataSourceTest.java

ìœ„ì—ì„œ ë³¸ OracleConnectionTestì™€ëŠ” ë‹¤ë¥´ê²Œ ìŠ¤í”„ë§ í™˜ê²½ì— ìˆëŠ” ê°ì²´ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ë¯€ë¡œ Junitê³¼ Springì„ ì—°ê²°í•´ì£¼ëŠ” ì½”ë“œê°€ í•„ìš”í•˜ë‹¤. ì´ë¥¼ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = {"file:src/main/webapp/WEB-INF/spring/*.xml"})
public class DataSourceTest {
	
	@Autowired
	private DataSource dataSource;
	
	@Test
	public void testHikari() throws SQLException {
		Connection conn = dataSource.getConnection();
		assertNotNull(conn);
	}
}
```

# ğŸ“˜ MyBatis

> MyBatisëŠ” ìë°” ê°œë°œìë“¤ì´ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ORM(Object-Relational Mapping) í”„ë ˆì„ì›Œí¬ì´ë‹¤. MyBatisëŠ”ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ì—¬ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ìƒì‚°ì„±ì„ ë†’ì´ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤.
> 

## ğŸ“– ì¤€ë¹„ ì‚¬í•­

1. í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬
    
    ê¸€ì˜ ì²˜ìŒì—ì„œ ë‹¤ë£¬ ëŒ€ë¡œ pom.xmlì— mybatisì™€ mybatis-spring ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‘ì„±í•´ì¤€ë‹¤.
    
2. Configuration íŒŒì¼
    
    **ex) mybatis-config.xml**
    
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE configuration
      PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
      "https://mybatis.org/dtd/mybatis-3-config.dtd">
    <configuration>
      <typeAliases>
       <typeAlias type="com.mysite.domain.Board" alias="Board"/>
      </typeAliases>
    </configuration>
    ```
    
3. Mapper íŒŒì¼
    
    **ex) board-mapper.xml**
    
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
      "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
      
    <mapper namespace="com.mysite.boardMapper">
      <insert id="write" parameterType="Board">
      	insert into simpleBoard(bNo, bTitle, bWriter, bContent)
      	values(seq_bno.nextVal, #{bTitle}, #{bWriter}, #{bContent})
      </insert>
      
      <select id="getList" resultType="Board">
      	select * from simpleBoard order by bNo desc
      </select>
      
      <select id="getBoard" parameterType="int" resultType="Board">
      	select * from simpleBoard where bNo = #{bNo}
      </select>
    </mapper>
    ```
    
    Configuration fileì— ë”°ë¡œ Aliasë¥¼ ì§€ì •í•´ì£¼ì§€ ì•Šìœ¼ë©´, Typeì„ ì ì„ ë•Œ í´ë˜ìŠ¤ê°€ ì €ì¥ëœ íŒ¨í‚¤ì§€ ê²½ë¡œê¹Œì§€ ë‹¤ ì ì–´ì£¼ì–´ì•¼ í•œë‹¤.
    

## ğŸ“– í•„ìš”í•œ ê°ì²´

1. SqlSessionFactory : SqlSessionì„ ìƒì„±í•´ì„œ ì œê³µ
2. SqlSession : Sql ëª…ë ¹ì„ ìˆ˜í–‰í•˜ëŠ”ë° í•„ìš”í•œ ë©”ì„œë“œ ì œê³µ
3. SqlSessionFactoryBean : SqlSessionFactoryë¥¼ Springì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ Bean ê°ì²´
4. SqlSessionTemplate : Sql ëª…ë ¹ì„ ìˆ˜í–‰í•˜ëŠ”ë° í•„ìš”í•œ ë©”ì„œë“œ ì œê³µ(Thread-Safe)

```xml
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
	<property name="dataSource" ref="dataSource"></property>
	<property name="configLocation" value="classpath:/mybatis-config.xml"></property>
	<property name="mapperLocations" value="classpath:/*mapper.xml"></property>
</bean>
<bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate" 
	destroy-method="clearCache">
	<constructor-arg name="sqlSessionFactory" ref="sqlSessionFactory" />
</bean>
```

MyBatis ë˜í•œ DI patternì„ ì´ìš©í•œë‹¤. SqlSessionFactoryBean í´ë˜ìŠ¤ì˜ setter ë©”ì„œë“œì— ìœ„ì—ì„œ ì¤€ë¹„í•œ Configuration íŒŒì¼ê³¼ Mapper íŒŒì¼ë“¤ì„ ë„˜ê²¨ì£¼ë©´ ëœë‹¤. 

destroy-method ì†ì„±ì„ ì§€ì •í•¨ìœ¼ë¡œì¨ ë”°ë¡œ close ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

### âš ï¸ ì™œ ê²½ë¡œì— `classpath:` pseudo protocolì„ ë¶™ì—¬ì¤˜ì•¼ í• ê¹Œ?

ì„¤ì • íŒŒì¼ê³¼ mapper íŒŒì¼ ë‘˜ ë‹¤ ì´ë¯¸ classpathì— ë“±ë¡ë˜ì–´ ìˆëŠ” íŒŒì¼ë“¤(src/main/resources/ ê²½ë¡œì— ìœ„ì¹˜)ì´ë¼ ê·¸ëƒ¥ íŒŒì¼ ì´ë¦„ë§Œ ê²½ë¡œì— ë„£ì–´ì£¼ë©´ ë  ì¤„ ì•Œì•˜ëŠ”ë°, ê·¸ë ‡ì§€ ì•Šì•˜ë‹¤. SqlSessionFactoryBean í´ë˜ìŠ¤ì˜ setter ë©”ì„œë“œë“¤ì€ ì ˆëŒ€ ê²½ë¡œë¡œ ê²½ë¡œ ê°’ë“¤ì´ ë‹¤ë¤„ì§€ë„ë¡ ì½”ë“œê°€ ì§œì—¬ìˆë‹¤ëŠ” ê²ƒì„ ë’¤ëŠ¦ê²Œ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. ì°¸ê³ ë¡œ, `classpath:` ë¥¼ ê²½ë¡œì— ì¶”ê°€í•´ ì£¼ë©´ classpathì— ìˆëŠ” ëª¨ë“  ê²½ë¡œë¥¼ ë’¤ì ¸ì„œ ì°¾ì•„ì¤€ë‹¤.

```java
public void setConfigLocation(Resource configLocation) {
  this.configLocation = configLocation;
}
```

[SqlSessionFactoryBean.java](http://SqlSessionFactoryBean.java) íŒŒì¼ì„ ë³´ë©´ ê²½ë¡œ ê°’ì„ ë°›ëŠ” ë³€ìˆ˜ì˜ íƒ€ì…ì´ Resourceë¡œ ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. [Resource.java](http://Resource.java) íŒŒì¼ì„ ë³´ë©´ ì¸í„°í˜ì´ìŠ¤ì„ì„ ì•Œ ìˆ˜ ìˆê³ , ClassPathResource í´ë˜ìŠ¤ì—ì„œ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆìŒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. ì´ í´ë˜ìŠ¤ì˜ ìƒì„±ìëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```java
public ClassPathResource(String path, @Nullable Class<?> clazz) {
	Assert.notNull(path, "Path must not be null");
	this.path = StringUtils.cleanPath(path);

	String absolutePath = this.path;
	if (clazz != null && !absolutePath.startsWith("/")) {
		absolutePath = ClassUtils.classPackageAsResourcePath(clazz) + "/" + absolutePath;
	}
	else if (absolutePath.startsWith("/")) {
		absolutePath = absolutePath.substring(1);
	}
	this.absolutePath = absolutePath;

	this.classLoader = null;
	this.clazz = clazz;
}
```

ëŒ€ì¶© ë´ì„œëŠ” ì½”ë“œì˜ ë‚´ìš©ì„ ì´í•´í•˜ê¸° ì–´ë µì§€ë§Œ, ì ˆëŒ€ ê²½ë¡œë¡œ ê°’ì„ ë°›ëŠ”ë‹¤ëŠ” ê²ƒ ì •ë„ëŠ” ëŒ€ì¶© ì•Œ ìˆ˜ ìˆì—ˆë‹¤â€¦

ì°¸ê³ 

---

[https://enspring.tistory.com/601](https://enspring.tistory.com/601)

[https://github.com/spring-projects/spring-framework/blob/main/spring-core/src/main/java/org/springframework/core/io/ClassPathResource.java](https://github.com/spring-projects/spring-framework/blob/main/spring-core/src/main/java/org/springframework/core/io/ClassPathResource.java)

[https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/SqlSessionFactoryBean.java](https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/SqlSessionFactoryBean.java)