---
layout: single
title: DGL ëª¨ë“ˆì„ í™œìš©í•œ ê·¸ë˜í”„ ìƒì„±
categories: [Python]
tag: [Python, 'DGL', 'GNN', 'AI']
toc: true
---


[https://docs.dgl.ai/guide_ko/graph-graphs-nodes-edges.html](https://docs.dgl.ai/guide_ko/graph-graphs-nodes-edges.html)

## ğŸ“– ê·¸ë˜í”„ ê¸°ë³¸ì ì¸ ì •ì˜

- ì—ì§€ì˜ ë°©í–¥ì„±ì— ë”°ë¼ì„œ, directed / undirectedë¡œ êµ¬ë¶„
- ê°€ì¤‘ì¹˜ì˜ ì—¬ë¶€ì— ë”°ë¼ì„œ, weighted / unweightedë¡œ êµ¬ë¶„
- ë…¸ë“œì˜ íƒ€ì…ì´ ëª¨ë‘ ê°™ì€ì§€ ì—¬ë¶€ì— ë”°ë¼ì„œ ë™ì¢…(homogeneous) / ì´ì¢…(heterogeneous)ë¡œ êµ¬ë¶„
    - ì´ë¶„ ê·¸ë˜í”„(bipartite graph)ëŠ” ì´ì¢… ê·¸ë˜í”„ì˜ íŠ¹ë³„í•œ í˜•íƒœë¡œ, ì—ì§€ëŠ” ì„œë¡œ ë‹¤ë¥¸ ë‘ íƒ€ì…ì˜ ë…¸ë“œë¥¼ ì—°ê²°. ì¶”ì²œ ì‹œìŠ¤í…œì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë¨.

## âœ…ê·¸ë˜í”„ ìƒì„±í•˜ê¸°

> ì—¬ëŸ¬ ë…¸ë“œë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ì„œ DGLëŠ” ë…¸ë“œ IDë¡œ 1ì°¨ì› ì •ìˆ˜ í…ì„œë¥¼ ì‚¬ìš©í•œë‹¤. (PyTorchì˜ tensor, TensorFlowì˜ Tensor, ë˜ëŠ” MXNetì˜ ndarry) DGLì€ ì´ í¬ë©§ì„ â€œë…¸ë“œ-í…ì„œâ€ë¼ê³  ë¶€ë¥¸ë‹¤. DGLì—ì„œ ì—ì§€ë“¤ì€ ë…¸ë“œ-í…ì„œì˜ íŠœí”Œ (U,V) ë¡œ í‘œí˜„ëœë‹¤. (U[i],V[i])ëŠ” U[i] ì—ì„œ V[i]ë¡œì˜ ì—ì§€ì´ë‹¤.
> 

![image.png]({{"../../../../assets/images/Python/DGL1/image.png" | relative_url}})

```python
import dgl
import torch as th

# edges 0->1, 0->2, 0->3, 1->3
u, v = th.tensor([0, 0, 0, 1]), th.tensor([1, 2, 3, 3])
g = dgl.graph((u, v))

print(g)
print(g.nodes())
print(g.edges())
print(g.edges(form='all'))

# Graph(num_nodes=6, num_edges=4,
#      ndata_schemes={}
#      edata_schemes={})
#tensor([0, 1, 2, 3, 4, 5])
#(tensor([0, 0, 1, 5]), tensor([1, 2, 2, 0]))
#(tensor([0, 0, 1, 5]), tensor([1, 2, 2, 0]), tensor([0, 1, 2, 3]))
```

## âœ… ë…¸ë“œ ë° ì—ì§€ì˜ feature ì„¤ì •í•˜ê¸°

```python
g.ndata['feat'] = th.randn(g.num_nodes(), 5)
weights = th.tensor([0.1, 0.6, 0.9, 0.7])
g.edata['w'] = weights

print(g.ndata['feat'])
print(g.edata['w'])
#tensor([[ 0.0616,  1.6565,  0.1940, -0.5374, -0.6856],
#        [-1.7733, -1.1384,  1.3491, -0.4095, -2.8695],
#        [ 0.2854,  1.3816, -1.1483, -0.1895, -1.3160],
#        [-0.3102, -0.1107,  0.1282, -0.4775,  0.6557],
#        [-0.3523, -0.3775, -1.3288,  0.1205, -0.2521],
#        [-0.3051,  0.9397,  0.5969,  0.5036, -1.9567]])
#tensor([0.1000, 0.6000, 0.9000, 0.7000])
```

## âœ… ì™¸ë¶€ ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•œ ê·¸ë˜í”„ ìƒì„±í•˜ê¸°

### ğŸ“– SciPy í¬ì†Œ í–‰ë ¬

> "Scientific Python"ì˜ ì¤„ì„ë§ë¡œ, ê³¼í•™ ë° ê³µí•™ ê³„ì‚°ì„ ìœ„í•œ íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. **`scipy.sparse`** ëª¨ë“ˆì„ í†µí•´ ë‹¤ì–‘í•œ ìœ í˜•ì˜ í¬ì†Œ í–‰ë ¬ì„ ì œê³µí•œë‹¤. ì¼ë°˜ì ì¸ í–‰ë ¬ í‘œí˜„(ë°€ì§‘ í–‰ë ¬, Dense Matrix)ë¡œëŠ” ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë¹„íš¨ìœ¨ì ì´ë¯€ë¡œ, non-zero ê°’ë§Œ ì €ì¥í•˜ì—¬ íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í•œ ë°ì´í„° êµ¬ì¡°ë‹¤.
> 

```python
import scipy.sparse as sp

spmat = sp.rand(100, 100, density=0.05) # 5% nonzero entries
sp_graph = dgl.from_scipy(spmat)
print(sp_graph)
#Graph(num_nodes=100, num_edges=500,
#      ndata_schemes={}
#      edata_schemes={})
```

## âœ… ì´ì¢… ê·¸ë˜í”„ ìƒì„±í•˜ê¸°

```python
graph_data = {
  ('drug', 'interacts', 'drug') : (th.tensor([0, 1]), th.tensor([1, 2])),
  ('drug', 'interacts', 'gene'): (th.tensor([0, 1]), th.tensor([2, 3])),
  ('drug', 'treats', 'disease'): (th.tensor([1]), th.tensor([2]))
}

hetero = dgl.heterograph(graph_data)

print(hetero)
#Graph(num_nodes={'disease': 3, 'drug': 3, 'gene': 4},
#      num_edges={('drug', 'interacts', 'drug'): 2,
#                 ('drug', 'interacts', 'gene'): 2,
#                 ('drug', 'treats', 'disease'): 1},
#      metagraph=[('drug', 'drug', 'interacts'),
#                 ('drug', 'gene', 'interacts'),
#                 ('drug', 'disease', 'treats')])
print(hetero.ntypes)
#['disease', 'drug', 'gene']
print(hetero.etypes)
#['interacts', 'interacts', 'treats']
print(hetero.canonical_etypes)
#[('drug', 'interacts', 'drug'),
# ('drug', 'interacts', 'gene'),
# ('drug', 'treats', 'disease')]

# A homogeneous graph
# dgl.heterograph({('node_type', 'edge_type', 'node_type'): (u, v)})
# A bipartite graph
# dgl.heterograph({('source_type', 'edge_type', 'destination_type'): (u, v)})
```

- metagraphëŠ” ê·¸ë˜í”„ì˜ ìŠ¤í‚¤ë§ˆë¡œ, ë…¸ë“œ íƒ€ì… ê°„ì— ì—ì§€ê°€ ì¡´ì¬í•¨ì„ ì•Œë ¤ì¤€ë‹¤.

```python
# Set/get feature 'hv' for nodes of type 'drug'
hetero.nodes['drug'].data['hv'] = th.ones(3, 1)
print(hetero.nodes['drug'].data['hv'])
#tensor([[1.],
#        [1.],
#        [1.]])
# Set/get feature 'he' for edge of type 'treats'
hetero.edges['treats'].data['he'] = th.zeros(1, 1)
print(hetero.edges['treats'].data['he'])
#tensor([[0.]])
```

- ìœ„ì™€ ê°™ì´ íŠ¹ì • ë…¸ë“œë‚˜ ì—ì§€ íƒ€ì…ì— ëŒ€í•œ featureë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

## âœ… GPUì—ì„œ DGLGraph ì‚¬ìš©í•˜ê¸°

```python
print(g.device)
#cpu
u, v = u.to('cuda:0'), v.to('cuda:0')
g = dgl.graph((u, v))
print(g.device)
#cuda:0
cuda_g = g.to('cuda:0')
print(cuda_g.device)
#cuda:0
```

- to() apië¥¼ ì‚¬ìš©í•´ì„œ ê·¸ë˜í”„ êµ¬ì¡°ì™€ í”¼ì²˜ ë°ì´í„°ë¥¼ í•¨ê»˜ gpuë¡œ ë³µì‚¬í•  ìˆ˜ ìˆë‹¤.
- ì´ ê²½ìš° ëª¨ë“  ì—°ì‚°ì€ gpuì—ì„œ ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì—, ëª¨ë“  í…ì„œ ì¸ìë“¤ì´ gpuì— ì¡´ì¬í•´ì•¼í•œë‹¤.
- ìœ„ì™€ ê°™ì´ gpuì— ìˆëŠ” ì¸ìë“¤ë¡œ ê·¸ë˜í”„ë¥¼ ìƒì„±í•˜ë©´, ìë™ìœ¼ë¡œ gpuì—ì„œ ë§Œë“¤ì–´ì§„ë‹¤.